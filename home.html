<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>Web share test</title>
</head>
<body>
<h1>Web share test</h1>
<h2>local image</h2>
<img id="img1" src="./Selection_309.png"
     style="-webkit-user-select: none;max-width: 100%;margin: auto;">

<h2>hosted image</h2>
<img id="img2" src="https://via.placeholder.com/300/09f/fff.png" 
     style="-webkit-user-select: none;max-width: 100%;margin: auto;">

<script>
  let url = new Request("Selection_309.png");
  const img1 = document.getElementById('img1');
  const img2 = document.getElementById('img2');
  const localImageShare = () => {
    createFile(url);
  };
 async function createFile(url) {
      let response = await fetch(url, {mode: 'no-cors'});
      let data = await response.blob();
      shareFile(data)
      // ... do something with the file or return it
    }

  const hostedImageShare = () => {
    let canvas = document.createElement("canvas");
    let img_ = img2;
    img_.crossOrigin = "anonymous";
    canvas.width = img_.width;
    canvas.height = img_.height;
    let ctx = canvas.getContext("2d");
    ctx.drawImage(img_, 0, 0);
    let dataURL = canvas.toDataURL("image/png");
    //let b64Data = dataURL.replace(/^data:image\/(png|jpg);base64,/, "");
    //
    createFile(dataURL); 
  };

const b64toBlob = (b64Data, contentType='', sliceSize=512) => {
  const byteCharacters = atob(b64Data);
  const byteArrays = [];

  for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {
    const slice = byteCharacters.slice(offset, offset + sliceSize);

    const byteNumbers = new Array(slice.length);
    for (let i = 0; i < slice.length; i++) {
      byteNumbers[i] = slice.charCodeAt(i);
    }

    const byteArray = new Uint8Array(byteNumbers);
    byteArrays.push(byteArray);
  }

  const blob = new Blob(byteArrays, {type: contentType});
  return blob;
}








  const shareFile = (data) => {
    let metadata = {
      type: 'image/png'
    };
    let file = new File([data], "test.jpg", metadata);
    console.log(file)
    if (navigator.canShare && navigator.canShare({files: [file]})) {
      navigator.share({
        title: 'Ashish share a file',
        files: [file],
        text: 'sharing images is fun'

      });
    }
  };

  img1.addEventListener('click', localImageShare);
  img2.addEventListener('click', hostedImageShare);

</script>
</body>
</html>

